<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OneJourney - Smart Mobility Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --bg-primary:#0a0d1a;--bg-secondary:#111627;--bg-elevated:#1a1f35;
            --bg-card:#1e2440;--bg-input:#151a30;
            --accent:#00e89d;--accent-dim:rgba(0,232,157,0.12);--accent-border:rgba(0,232,157,0.25);
            --accent2:#00b4d8;--accent2-dim:rgba(0,180,216,0.12);
            --warn:#f59e0b;--warn-dim:rgba(245,158,11,0.12);
            --error:#ef4444;--success:#22c55e;
            --text:#f1f5f9;--text2:#94a3b8;--text3:#64748b;
            --border:#1e293b;--border2:#2d3a54;
            --shadow:0 4px 24px rgba(0,0,0,0.5);--shadow-lg:0 12px 48px rgba(0,0,0,0.7);
            --radius:14px;--radius-sm:10px;--radius-xs:8px;
        }
        html,body{height:100%;overflow:hidden}
        body{font-family:'Inter',system-ui,sans-serif;background:#050810;color:var(--text);-webkit-font-smoothing:antialiased;-webkit-tap-highlight-color:transparent}
        
        .app{max-width:430px;margin:0 auto;height:100vh;position:relative;overflow:hidden;background:var(--bg-primary);box-shadow:0 0 100px rgba(0,232,157,0.03)}
        
        /* Status Bar */
        .status-bar{height:44px;display:flex;align-items:center;justify-content:space-between;padding:0 20px;font-size:12px;font-weight:600;color:var(--text2);background:var(--bg-primary);position:relative;z-index:200}
        .status-time{font-weight:700;color:var(--text)}
        .status-icons{display:flex;gap:6px;align-items:center;font-size:14px}
        
        /* Header */
        .header{position:relative;z-index:150;padding:0 16px 14px;background:var(--bg-primary);border-bottom:1px solid var(--border)}
        .header-top{display:flex;justify-content:space-between;align-items:center}
        .logo{font-size:20px;font-weight:800;letter-spacing:-0.5px}
        .logo span{background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .header-actions{display:flex;gap:8px;align-items:center}
        
        .h-btn{width:38px;height:38px;border-radius:var(--radius-sm);border:1px solid var(--border);background:var(--bg-elevated);color:var(--text2);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;transition:all 0.15s;position:relative}
        .h-btn:active{transform:scale(0.95)}
        .h-btn .dot{position:absolute;top:7px;right:7px;width:7px;height:7px;background:var(--error);border-radius:50%;border:2px solid var(--bg-elevated)}
        
        .wallet-btn{display:flex;align-items:center;gap:6px;padding:7px 14px;background:var(--accent-dim);border:1px solid var(--accent-border);border-radius:var(--radius-sm);cursor:pointer;transition:all 0.15s}
        .wallet-btn:active{transform:scale(0.97)}
        .wallet-btn .amt{font-size:13px;font-weight:700;color:var(--accent)}
        
        /* Map */
        .map-wrap{position:absolute;top:0;left:0;right:0;bottom:0;z-index:1}
        #map{width:100%;height:100%}
        .leaflet-tile-pane{filter:brightness(0.65) contrast(1.2) saturate(0.3) hue-rotate(180deg) invert(1)}
        .leaflet-control-attribution{display:none!important}
        
        .map-ctrls{position:absolute;top:180px;right:16px;z-index:100;display:flex;flex-direction:column;gap:8px}
        .map-ctrl{width:44px;height:44px;border-radius:var(--radius-sm);background:var(--bg-card);border:1px solid var(--border2);color:var(--text);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:18px;box-shadow:var(--shadow);transition:all 0.15s}
        .map-ctrl:active{transform:scale(0.93)}
        .map-ctrl.active{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}
        
        /* Pin Drop Crosshair */
        .crosshair{position:absolute;top:50%;left:50%;transform:translate(-50%,-100%);z-index:90;font-size:40px;filter:drop-shadow(0 4px 12px rgba(0,0,0,0.7));transition:opacity 0.2s;pointer-events:none;display:none}
        .crosshair.show{display:block;animation:pinPulse 1s ease infinite}
        @keyframes pinPulse{0%,100%{transform:translate(-50%,-100%)}50%{transform:translate(-50%,-110%)}}
        .crosshair-label{position:absolute;top:50%;left:50%;transform:translate(-50%,20px);z-index:90;background:var(--bg-card);border:1px solid var(--accent-border);padding:6px 14px;border-radius:20px;font-size:12px;font-weight:600;color:var(--accent);white-space:nowrap;display:none;pointer-events:none;box-shadow:var(--shadow)}
        .crosshair-label.show{display:block}
        
        /* Search Panel */
        .search-panel{position:absolute;top:110px;left:14px;right:14px;z-index:100;background:var(--bg-card);border:1px solid var(--border2);border-radius:var(--radius);box-shadow:var(--shadow-lg);padding:16px;transition:all 0.3s}
        
        .search-row{display:flex;gap:10px;align-items:center;margin-bottom:10px;position:relative}
        .search-dot{width:12px;height:12px;border-radius:50%;flex-shrink:0}
        .search-dot.pickup{background:var(--accent2);box-shadow:0 0 8px rgba(0,180,216,0.5)}
        .search-dot.drop{background:var(--accent);box-shadow:0 0 8px rgba(0,232,157,0.5)}
        .search-line{position:absolute;left:21px;top:28px;width:2px;height:calc(100% - 20px);background:var(--border2)}
        
        .s-input-wrap{flex:1;display:flex;align-items:center;background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius-xs);padding:0 10px;height:44px;transition:border-color 0.15s}
        .s-input-wrap:focus-within{border-color:var(--accent)}
        .s-input{flex:1;background:none;border:none;color:var(--text);font-size:14px;font-weight:500;outline:none;font-family:inherit}
        .s-input::placeholder{color:var(--text3)}
        .s-pin{width:30px;height:30px;border-radius:6px;background:var(--bg-card);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;flex-shrink:0;transition:all 0.15s}
        .s-pin:active{border-color:var(--accent);color:var(--accent)}
        
        .swap-btn{position:absolute;right:-8px;top:50%;transform:translateY(-50%);width:34px;height:34px;border-radius:50%;background:var(--bg-card);border:2px solid var(--border2);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;color:var(--text2);z-index:5;transition:all 0.2s}
        .swap-btn:hover{transform:translateY(-50%) rotate(180deg);border-color:var(--accent);color:var(--accent)}
        
        .search-actions{display:flex;gap:6px;margin-top:12px;padding-top:12px;border-top:1px solid var(--border)}
        .s-action{flex:1;padding:10px;background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius-xs);text-align:center;cursor:pointer;font-size:12px;font-weight:600;color:var(--text2);transition:all 0.15s}
        .s-action:active{transform:scale(0.97)}
        .s-action.active{background:var(--accent-dim);border-color:var(--accent-border);color:var(--accent)}
        
        .search-btn{width:100%;padding:13px;background:linear-gradient(135deg,var(--accent),#00c9a7);border:none;border-radius:var(--radius-xs);font-size:14px;font-weight:700;color:var(--bg-primary);cursor:pointer;margin-top:10px;transition:all 0.15s;display:flex;align-items:center;justify-content:center;gap:8px}
        .search-btn:active{transform:scale(0.98)}
        .search-btn:disabled{opacity:0.5;cursor:not-allowed}
        
        /* Riders Indicator */
        .riders-indicator{display:flex;align-items:center;gap:8px;margin-top:10px;padding:10px;background:rgba(0,232,157,0.06);border:1px solid rgba(0,232,157,0.1);border-radius:var(--radius-xs)}
        .riders-dots{display:flex;gap:4px}
        .r-dot{width:8px;height:8px;border-radius:50%;background:var(--accent);animation:riderPulse 2s ease infinite}
        .r-dot:nth-child(2){animation-delay:0.3s;opacity:0.7}
        .r-dot:nth-child(3){animation-delay:0.6s;opacity:0.5}
        @keyframes riderPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.3)}}
        .riders-text{font-size:12px;color:var(--text2)}
        .riders-text b{color:var(--accent)}
        
        /* Bottom Sheet */
        .sheet{position:absolute;bottom:0;left:0;right:0;z-index:120;background:var(--bg-card);border-radius:20px 20px 0 0;border:1px solid var(--border2);border-bottom:none;box-shadow:0 -8px 40px rgba(0,0,0,0.6);transition:transform 0.4s cubic-bezier(0.32,0.72,0,1);max-height:65vh;display:flex;flex-direction:column}
        .sheet.collapsed{transform:translateY(calc(100% - 80px))}
        .sheet.hidden{transform:translateY(100%)}
        .sheet-bar{padding:12px;display:flex;justify-content:center;cursor:grab}
        .sheet-bar-line{width:40px;height:4px;background:var(--border2);border-radius:2px}
        .sheet-body{flex:1;overflow-y:auto;padding:0 16px 100px;-webkit-overflow-scrolling:touch}
        .sheet-body::-webkit-scrollbar{width:0}
        
        .sheet-title{font-size:20px;font-weight:800;margin-bottom:16px;letter-spacing:-0.3px}
        
        /* Empty State */
        .empty{text-align:center;padding:40px 20px}
        .empty-icon{font-size:56px;margin-bottom:16px;opacity:0.7}
        .empty h3{font-size:20px;font-weight:700;margin-bottom:8px}
        .empty p{color:var(--text2);font-size:14px;line-height:1.6;margin-bottom:24px}
        
        .places-row{display:flex;gap:10px;overflow-x:auto;padding:4px 0 16px;-webkit-overflow-scrolling:touch}
        .places-row::-webkit-scrollbar{display:none}
        .place-card{min-width:130px;padding:16px;background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-sm);cursor:pointer;transition:all 0.15s}
        .place-card:active{transform:scale(0.97);border-color:var(--accent)}
        .place-emoji{font-size:28px;margin-bottom:8px}
        .place-name{font-weight:600;font-size:13px;margin-bottom:2px}
        .place-addr{font-size:11px;color:var(--text3)}
        
        /* Loading */
        .loading-state{text-align:center;padding:50px 20px}
        .loader{width:50px;height:50px;margin:0 auto 20px;border:4px solid var(--border2);border-top:4px solid var(--accent);border-radius:50%;animation:spin 0.8s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        
        /* Route Cards */
        .route-card{background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px;margin-bottom:12px;cursor:pointer;transition:all 0.2s;position:relative}
        .route-card:hover{border-color:var(--accent-border);transform:translateY(-2px)}
        .route-card.selected{border-color:var(--accent);background:var(--accent-dim)}
        
        .route-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}
        .route-mode{font-size:20px;font-weight:700;display:flex;align-items:center;gap:8px}
        .route-badge{font-size:9px;font-weight:700;padding:3px 8px;border-radius:12px;background:var(--accent-dim);color:var(--accent);text-transform:uppercase;letter-spacing:0.5px}
        .route-badge.eco{background:var(--success);color:#000}
        .route-badge.fast{background:var(--warn);color:#000}
        
        .route-price{font-size:24px;font-weight:800;color:var(--accent)}
        
        .route-mid{display:flex;gap:20px;margin-bottom:12px}
        .route-stat{flex:1}
        .route-stat-label{font-size:11px;color:var(--text3);margin-bottom:2px;text-transform:uppercase;letter-spacing:0.5px}
        .route-stat-val{font-size:15px;font-weight:700}
        
        .route-bot{display:flex;justify-content:space-between;align-items:center;padding-top:12px;border-top:1px solid var(--border)}
        .route-score{display:flex;align-items:center;gap:6px}
        .score-bar{height:6px;width:80px;background:var(--bg-input);border-radius:3px;overflow:hidden}
        .score-fill{height:100%;background:linear-gradient(90deg,var(--accent2),var(--accent));transition:width 0.3s}
        .score-num{font-size:12px;font-weight:700;color:var(--text2)}
        
        .route-btn{padding:8px 16px;background:var(--accent);color:var(--bg-primary);border:none;border-radius:var(--radius-xs);font-weight:700;font-size:13px;cursor:pointer;transition:all 0.15s}
        .route-btn:active{transform:scale(0.95)}
        
        /* Tabs */
        .tabs{display:flex;gap:6px;padding:0 16px 12px;border-bottom:1px solid var(--border);margin-bottom:16px}
        .tab{flex:1;padding:10px;background:none;border:none;color:var(--text3);font-weight:600;font-size:14px;cursor:pointer;border-bottom:2px solid transparent;transition:all 0.15s}
        .tab.active{color:var(--accent);border-bottom-color:var(--accent)}
        
        /* AI Chat */
        .ai-messages{display:flex;flex-direction:column;gap:12px;margin-bottom:16px;max-height:300px;overflow-y:auto}
        .ai-msg{max-width:85%;padding:12px 16px;border-radius:var(--radius-sm);font-size:14px;line-height:1.5}
        .ai-msg.user{align-self:flex-end;background:var(--accent);color:var(--bg-primary);border-bottom-right-radius:4px}
        .ai-msg.bot{align-self:flex-start;background:var(--bg-elevated);border:1px solid var(--border);border-bottom-left-radius:4px}
        
        .ai-input-wrap{display:flex;gap:8px;padding:12px;background:var(--bg-elevated);border-radius:var(--radius-sm);border:1px solid var(--border)}
        .ai-input{flex:1;background:none;border:none;color:var(--text);font-size:14px;outline:none;font-family:inherit}
        .ai-send{padding:8px 16px;background:var(--accent);color:var(--bg-primary);border:none;border-radius:var(--radius-xs);font-weight:700;cursor:pointer;transition:all 0.15s}
        .ai-send:active{transform:scale(0.95)}
        .ai-send:disabled{opacity:0.5;cursor:not-allowed}
        
        /* History */
        .history-item{display:flex;gap:12px;padding:14px;background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-sm);margin-bottom:10px}
        .hist-icon{font-size:32px;flex-shrink:0}
        .hist-info{flex:1}
        .hist-mode{font-weight:700;font-size:14px;margin-bottom:4px}
        .hist-details{font-size:12px;color:var(--text2)}
        .hist-date{font-size:11px;color:var(--text3);margin-top:4px}
        .hist-right{text-align:right}
        .hist-cost{font-size:18px;font-weight:800;color:var(--accent)}
        .hist-savings{font-size:11px;color:var(--success);margin-top:2px}
        
        /* Wallet Stats */
        .wallet-stats{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
        .wallet-stat{background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px;text-align:center}
        .wallet-stat-val{font-size:24px;font-weight:800;margin-bottom:4px}
        .wallet-stat-val.balance{color:var(--accent)}
        .wallet-stat-val.savings{color:var(--success)}
        .wallet-stat-label{font-size:12px;color:var(--text3);text-transform:uppercase;letter-spacing:0.5px}
        
        .topup-btn{width:100%;padding:14px;background:linear-gradient(135deg,var(--accent),#00c9a7);border:none;border-radius:var(--radius-xs);font-weight:700;color:var(--bg-primary);cursor:pointer;margin-bottom:20px;transition:all 0.15s}
        .topup-btn:active{transform:scale(0.98)}
        
        /* Toast */
        .toast{position:fixed;top:70px;left:50%;transform:translateX(-50%) translateY(-100px);z-index:300;background:var(--bg-card);border:1px solid var(--border2);border-radius:var(--radius-sm);padding:14px 20px;display:flex;align-items:center;gap:12px;box-shadow:var(--shadow-lg);opacity:0;transition:all 0.3s;pointer-events:none}
        .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
        .toast.success{border-color:var(--success);color:var(--success)}
        .toast.error{border-color:var(--error);color:var(--error)}
        .toast-icon{font-size:20px;font-weight:800}
        .toast-msg{font-size:14px;font-weight:600}
        
        /* Overlay */
        .overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.75);z-index:250;opacity:0;pointer-events:none;transition:opacity 0.3s}
        .overlay.show{opacity:1;pointer-events:all}
        
        /* Modal */
        .modal{position:fixed;bottom:0;left:0;right:0;z-index:260;background:var(--bg-card);border-radius:20px 20px 0 0;border:1px solid var(--border2);padding:24px;transform:translateY(100%);transition:transform 0.3s;max-height:80vh;overflow-y:auto}
        .modal.show{transform:translateY(0)}
        .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
        .modal-title{font-size:20px;font-weight:800}
        .modal-close{width:32px;height:32px;border-radius:50%;background:var(--bg-input);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:18px}
        
        .amount-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px}
        .amount-opt{padding:16px;background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius-xs);text-align:center;cursor:pointer;transition:all 0.15s}
        .amount-opt:active{transform:scale(0.97)}
        .amount-opt.selected{border-color:var(--accent);background:var(--accent-dim)}
        .amount-opt-val{font-size:20px;font-weight:800;margin-bottom:4px}
        .amount-opt-bonus{font-size:11px;color:var(--success)}
        
        /* Confirm Dialog */
        .confirm-dialog{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0.9);z-index:270;background:var(--bg-card);border:1px solid var(--border2);border-radius:var(--radius);padding:24px;max-width:320px;width:90%;opacity:0;pointer-events:none;transition:all 0.3s;box-shadow:var(--shadow-lg)}
        .confirm-dialog.show{opacity:1;transform:translate(-50%,-50%) scale(1);pointer-events:all}
        .cd-icon{font-size:48px;text-align:center;margin-bottom:16px}
        .cd-title{font-size:18px;font-weight:800;text-align:center;margin-bottom:8px}
        .cd-text{font-size:14px;color:var(--text2);text-align:center;margin-bottom:24px;line-height:1.5}
        .cd-actions{display:flex;gap:10px}
        .cd-btn{flex:1;padding:12px;border:none;border-radius:var(--radius-xs);font-weight:700;cursor:pointer;transition:all 0.15s}
        .cd-btn:active{transform:scale(0.97)}
        .cd-btn.cancel{background:var(--bg-input);color:var(--text2)}
        .cd-btn.confirm{background:var(--accent);color:var(--bg-primary)}
        
        /* Bottom Nav */
        .bottom-nav{position:absolute;bottom:0;left:0;right:0;z-index:140;background:var(--bg-card);border-top:1px solid var(--border2);display:flex;padding:8px 0;box-shadow:0 -4px 20px rgba(0,0,0,0.4)}
        .nav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;padding:8px;cursor:pointer;transition:all 0.15s;color:var(--text3);border-top:3px solid transparent}
        .nav-item.active{color:var(--accent);border-top-color:var(--accent)}
        .nav-icon{font-size:22px}
        .nav-label{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px}
        
        /* Tab Views */
        .tab-view{position:absolute;top:110px;left:0;right:0;bottom:72px;z-index:110;background:var(--bg-primary);transform:translateX(100%);transition:transform 0.3s;overflow-y:auto;padding:16px}
        .tab-view.active{transform:translateX(0)}
        .tab-view::-webkit-scrollbar{width:0}
        
        /* Challenge Cards */
        .challenge-card{background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px;margin-bottom:12px;position:relative;overflow:hidden}
        .challenge-card.completed{border-color:var(--success);background:rgba(34,197,94,0.08)}
        .challenge-top{display:flex;justify-content:space-between;align-items:start;margin-bottom:12px}
        .challenge-icon{font-size:32px}
        .challenge-reward{font-size:11px;background:var(--accent-dim);color:var(--accent);padding:4px 10px;border-radius:12px;font-weight:700}
        .challenge-card.completed .challenge-reward{background:var(--success);color:#000}
        .challenge-title{font-size:16px;font-weight:700;margin-bottom:4px}
        .challenge-desc{font-size:13px;color:var(--text2);margin-bottom:12px}
        .challenge-progress{display:flex;align-items:center;gap:10px}
        .progress-bar{flex:1;height:8px;background:var(--bg-input);border-radius:4px;overflow:hidden;position:relative}
        .progress-fill{height:100%;background:linear-gradient(90deg,var(--accent2),var(--accent));transition:width 0.3s;border-radius:4px}
        .progress-text{font-size:12px;font-weight:700;color:var(--text2);min-width:60px;text-align:right}
        .challenge-card.completed .progress-fill{background:var(--success)}
        .challenge-completed-badge{position:absolute;top:12px;right:12px;background:var(--success);color:#000;padding:4px 10px;border-radius:12px;font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:0.5px}
        
        /* Carbon Stats */
        .carbon-stat{background:linear-gradient(135deg,rgba(34,197,94,0.15),rgba(0,232,157,0.15));border:1px solid rgba(34,197,94,0.3);border-radius:var(--radius-sm);padding:20px;text-align:center;margin-bottom:20px}
        .carbon-icon{font-size:48px;margin-bottom:10px}
        .carbon-val{font-size:32px;font-weight:800;color:var(--success);margin-bottom:4px}
        .carbon-label{font-size:13px;color:var(--text2);text-transform:uppercase;letter-spacing:0.5px}
    </style>
</head>
<body>
<div class="app">
    <!-- Status Bar -->
    <div class="status-bar">
        <span class="status-time" id="statusTime">9:41</span>
        <div class="status-icons">
            <span>üì∂</span>
            <span>üì≥</span>
            <span>üîã</span>
        </div>
    </div>
    
    <!-- Header -->
    <div class="header">
        <div class="header-top">
            <div class="logo">One<span>Journey</span></div>
            <div class="header-actions">
                <div class="wallet-btn" onclick="openTab('walletView')">
                    <span>üí≥</span>
                    <span class="amt" id="walletBal">‚Çπ2,500</span>
                </div>
                <div class="h-btn" onclick="openTab('accountView')">
                    <span>üë§</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Map -->
    <div class="map-wrap">
        <div id="map"></div>
    </div>
    
    <!-- Map Controls -->
    <div class="map-ctrls">
        <div class="map-ctrl" onclick="centerMap()">üìç</div>
        <div class="map-ctrl" id="trafficToggle" onclick="toggleTraffic()">üö¶</div>
    </div>
    
    <!-- Crosshair for Pin Drop -->
    <div class="crosshair" id="crosshair">üìç</div>
    <div class="crosshair-label" id="crosshairLabel">Tap to set location</div>
    
    <!-- Search Panel -->
    <div class="search-panel">
        <div class="search-row" style="margin-bottom:15px">
            <span class="search-dot pickup"></span>
            <div class="s-input-wrap">
                <input type="text" class="s-input" id="pickupIn" placeholder="Enter pickup location">
                <div class="s-pin" onclick="pinDrop('pickup')" title="Pin on map">üìç</div>
            </div>
        </div>
        <div class="search-line"></div>
        <div class="search-row" style="position:relative">
            <span class="search-dot drop"></span>
            <div class="s-input-wrap">
                <input type="text" class="s-input" id="dropIn" placeholder="Enter destination">
                <div class="s-pin" onclick="pinDrop('drop')" title="Pin on map">üìç</div>
            </div>
            <div class="swap-btn" onclick="swapLocations()" title="Swap">‚áÖ</div>
        </div>
        
        <div class="search-actions">
            <div class="s-action" id="fastestToggle" onclick="toggleFilter('fastest')">‚ö° Fastest</div>
            <div class="s-action" id="ecoToggle" onclick="toggleFilter('eco')">üåø Eco</div>
            <div class="s-action" id="budgetToggle" onclick="toggleFilter('budget')">üí∞ Budget</div>
        </div>
        
        <button class="search-btn" id="searchBtn" onclick="searchRoutes()" disabled>
            <span>üîç</span>
            <span>Find Routes</span>
        </button>
        
        <div class="riders-indicator">
            <div class="riders-dots">
                <div class="r-dot"></div>
                <div class="r-dot"></div>
                <div class="r-dot"></div>
            </div>
            <div class="riders-text"><b id="riderCount">12</b> riders searching now</div>
        </div>
    </div>
    
    <!-- Bottom Sheet (Routes) -->
    <div class="sheet collapsed" id="routeSheet">
        <div class="sheet-bar" onclick="toggleSheet()">
            <div class="sheet-bar-line"></div>
        </div>
        <div class="sheet-body" id="sheetBody">
            <div class="empty">
                <div class="empty-icon">üó∫Ô∏è</div>
                <h3>Ready to explore?</h3>
                <p>Enter your pickup and destination to discover the smartest routes tailored just for you.</p>
                
                <div class="places-row">
                    <div class="place-card" onclick="quickFill('SRM University','Phoenix Market City')">
                        <div class="place-emoji">üè´</div>
                        <div class="place-name">SRM to Phoenix</div>
                        <div class="place-addr">~14 km</div>
                    </div>
                    <div class="place-card" onclick="quickFill('Chennai Central','Marina Beach')">
                        <div class="place-emoji">üèñÔ∏è</div>
                        <div class="place-name">Central to Marina</div>
                        <div class="place-addr">~6 km</div>
                    </div>
                    <div class="place-card" onclick="quickFill('T Nagar','Guindy')">
                        <div class="place-emoji">üõçÔ∏è</div>
                        <div class="place-name">T Nagar to Guindy</div>
                        <div class="place-addr">~8 km</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Wallet Tab -->
    <div class="tab-view" id="walletView">
        <h2 class="sheet-title">üí≥ My Wallet</h2>
        
        <div class="wallet-stats">
            <div class="wallet-stat">
                <div class="wallet-stat-val balance" id="walletBalance">‚Çπ2,500</div>
                <div class="wallet-stat-label">Balance</div>
            </div>
            <div class="wallet-stat">
                <div class="wallet-stat-val savings" id="walletSavings">‚Çπ0</div>
                <div class="wallet-stat-label">Total Saved</div>
            </div>
        </div>
        
        <button class="topup-btn" onclick="openModal('topupModal')">+ Add Money</button>
        
        <!-- Weekly Challenges -->
        <h3 style="font-size:16px;font-weight:700;margin-bottom:12px">üéØ Weekly Challenges</h3>
        <div id="challengesContainer"></div>
        
        <!-- Carbon Saved -->
        <div class="carbon-stat" id="carbonStat" style="display:none">
            <div class="carbon-icon">üå≥</div>
            <div class="carbon-val" id="carbonVal">0g</div>
            <div class="carbon-label">Total CO‚ÇÇ Saved</div>
        </div>
        
        <h3 style="font-size:16px;font-weight:700;margin-bottom:12px;margin-top:20px">üìã Recent Trips</h3>
        <div id="tripHistory"></div>
    </div>
    
    <!-- AI Tab -->
    <div class="tab-view" id="aiView">
        <h2 class="sheet-title">ü§ñ AI Assistant</h2>
        
        <div class="ai-messages" id="aiMessages">
            <div class="ai-msg bot">
                üëã Hi! I'm your OneJourney AI assistant. Ask me anything about routes, transport options, or travel tips!
            </div>
        </div>
        
        <div class="ai-input-wrap">
            <input type="text" class="ai-input" id="aiInput" placeholder="Ask me anything..." onkeypress="if(event.key==='Enter')askAI()">
            <button class="ai-send" id="aiSendBtn" onclick="askAI()">Send</button>
        </div>
    </div>
    
    <!-- Account Tab -->
    <div class="tab-view" id="accountView">
        <h2 class="sheet-title">üë§ Account</h2>
        <div id="accountBody"></div>
    </div>
    
    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="openTab('mapView')">
            <span class="nav-icon">üè†</span>
            <span class="nav-label">Home</span>
        </div>
        <div class="nav-item" onclick="openTab('walletView')">
            <span class="nav-icon">üí≥</span>
            <span class="nav-label">Wallet</span>
        </div>
        <div class="nav-item" onclick="openTab('aiView')">
            <span class="nav-icon">ü§ñ</span>
            <span class="nav-label">AI</span>
        </div>
        <div class="nav-item" onclick="openTab('accountView')">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span class="nav-label">Account</span>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span class="toast-icon" id="toastIcon">‚úì</span>
        <span class="toast-msg" id="toastMsg">Success!</span>
    </div>
    
    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="closeAllModals()"></div>
    
    <!-- Topup Modal -->
    <div class="modal" id="topupModal">
        <div class="modal-header">
            <h3 class="modal-title">üí≥ Add Money</h3>
            <div class="modal-close" onclick="closeModal('topupModal')">√ó</div>
        </div>
        
        <div class="amount-grid">
            <div class="amount-opt" onclick="selectAmount(500)">
                <div class="amount-opt-val">‚Çπ500</div>
            </div>
            <div class="amount-opt" onclick="selectAmount(1000)">
                <div class="amount-opt-val">‚Çπ1,000</div>
                <div class="amount-opt-bonus">+‚Çπ50 bonus</div>
            </div>
            <div class="amount-opt" onclick="selectAmount(2000)">
                <div class="amount-opt-val">‚Çπ2,000</div>
                <div class="amount-opt-bonus">+‚Çπ150 bonus</div>
            </div>
            <div class="amount-opt" onclick="selectAmount(5000)">
                <div class="amount-opt-val">‚Çπ5,000</div>
                <div class="amount-opt-bonus">+‚Çπ500 bonus</div>
            </div>
        </div>
        
        <button class="topup-btn" onclick="confirmTopup()">Add to Wallet</button>
    </div>
    
    <!-- Confirm Dialog -->
    <div class="confirm-dialog" id="confirmDialog">
        <div class="cd-icon" id="cdIcon">‚úì</div>
        <div class="cd-title" id="cdTitle">Confirm</div>
        <div class="cd-text" id="cdText">Are you sure?</div>
        <div class="cd-actions">
            <button class="cd-btn cancel" onclick="hideConfirm()">Cancel</button>
            <button class="cd-btn confirm" id="cdConfirm">Confirm</button>
        </div>
    </div>
</div>

<script>
// =================== CONFIG ===================
const API_BASE = 'http://localhost:5000/api';
let map, pickupMarker, dropMarker;
let currentRoutes = [];
let selectedRoute = null;
let filters = { fastest: false, eco: false, budget: false, maxBudget: null };
let pinDropMode = null; // 'pickup' or 'drop'

// State
const S = {
    pickup: null,
    drop: null,
    routes: [],
    wallet: { balance: 2500, totalSaved: 0, trips: [] }
};

// =================== MAP INITIALIZATION ===================
function initMap() {
    map = L.map('map', {
        zoomControl: false,
        attributionControl: false
    }).setView([13.0827, 80.2707], 12); // Chennai
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    
    map.on('click', function(e) {
        if (pinDropMode) {
            const { lat, lng } = e.latlng;
            if (pinDropMode === 'pickup') {
                setPickupMarker(lat, lng);
                reverseGeocode(lat, lng, (address) => {
                    document.getElementById('pickupIn').value = address;
                    S.pickup = { lat, lng, address };
                });
            } else if (pinDropMode === 'drop') {
                setDropMarker(lat, lng);
                reverseGeocode(lat, lng, (address) => {
                    document.getElementById('dropIn').value = address;
                    S.drop = { lat, lng, address };
                    checkReadyToSearch();
                });
            }
            exitPinDrop();
        }
    });
}

function setPickupMarker(lat, lng) {
    if (pickupMarker) map.removeLayer(pickupMarker);
    pickupMarker = L.marker([lat, lng], {
        icon: L.divIcon({ className: 'custom-marker', html: 'üìç', iconSize: [30, 30] })
    }).addTo(map);
}

function setDropMarker(lat, lng) {
    if (dropMarker) map.removeLayer(dropMarker);
    dropMarker = L.marker([lat, lng], {
        icon: L.divIcon({ className: 'custom-marker', html: 'üéØ', iconSize: [30, 30] })
    }).addTo(map);
}

function centerMap() {
    if (S.pickup && S.drop) {
        const bounds = L.latLngBounds([
            [S.pickup.lat, S.pickup.lng],
            [S.drop.lat, S.drop.lng]
        ]);
        map.fitBounds(bounds, { padding: [50, 50] });
    } else if (S.pickup) {
        map.setView([S.pickup.lat, S.pickup.lng], 14);
    } else {
        map.setView([13.0827, 80.2707], 12);
    }
}

// =================== PIN DROP MODE ===================
function pinDrop(type) {
    pinDropMode = type;
    document.getElementById('crosshair').classList.add('show');
    document.getElementById('crosshairLabel').classList.add('show');
    document.getElementById('crosshairLabel').textContent = 
        type === 'pickup' ? 'Tap map for pickup' : 'Tap map for destination';
    map.dragging.enable();
}

function exitPinDrop() {
    pinDropMode = null;
    document.getElementById('crosshair').classList.remove('show');
    document.getElementById('crosshairLabel').classList.remove('show');
}

// =================== GEOCODING ===================
async function reverseGeocode(lat, lng, callback) {
    try {
        const res = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`);
        const data = await res.json();
        callback(data.display_name || `${lat.toFixed(4)}, ${lng.toFixed(4)}`);
    } catch (err) {
        callback(`${lat.toFixed(4)}, ${lng.toFixed(4)}`);
    }
}

async function forwardGeocode(query, callback) {
    try {
        const res = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)}&format=json&limit=1`);
        const data = await res.json();
        if (data[0]) {
            callback({ lat: parseFloat(data[0].lat), lng: parseFloat(data[0].lon), address: query });
        } else {
            callback(null);
        }
    } catch (err) {
        callback(null);
    }
}

// =================== LOCATION SWAP & QUICK FILL ===================
function swapLocations() {
    const p = document.getElementById('pickupIn');
    const d = document.getElementById('dropIn');
    [p.value, d.value] = [d.value, p.value];
    [S.pickup, S.drop] = [S.drop, S.pickup];
    
    if (pickupMarker && dropMarker) {
        const temp = pickupMarker.getLatLng();
        pickupMarker.setLatLng(dropMarker.getLatLng());
        dropMarker.setLatLng(temp);
    }
    
    checkReadyToSearch();
}

function quickFill(pickup, drop) {
    document.getElementById('pickupIn').value = pickup;
    document.getElementById('dropIn').value = drop;
    
    // Geocode both
    forwardGeocode(pickup, (pRes) => {
        if (pRes) {
            S.pickup = pRes;
            setPickupMarker(pRes.lat, pRes.lng);
        }
    });
    
    forwardGeocode(drop, (dRes) => {
        if (dRes) {
            S.drop = dRes;
            setDropMarker(dRes.lat, dRes.lng);
            checkReadyToSearch();
        }
    });
}

// =================== FILTERS ===================
function toggleFilter(type) {
    const btn = document.getElementById(`${type}Toggle`);
    filters[type] = !filters[type];
    btn.classList.toggle('active');
}

function checkReadyToSearch() {
    const pickup = document.getElementById('pickupIn').value.trim();
    const drop = document.getElementById('dropIn').value.trim();
    document.getElementById('searchBtn').disabled = !(pickup && drop);
}

// Listen to input changes
document.addEventListener('DOMContentLoaded', () => {
    ['pickupIn', 'dropIn'].forEach(id => {
        document.getElementById(id).addEventListener('input', checkReadyToSearch);
    });
});

// =================== ROUTE SEARCH ===================
async function searchRoutes() {
    const pickup = document.getElementById('pickupIn').value.trim();
    const drop = document.getElementById('dropIn').value.trim();
    
    if (!pickup || !drop) {
        showToast('Please enter both locations', 'error');
        return;
    }
    
    showLoading();
    
    try {
        const constraints = {
            fastest: filters.fastest,
            ecoMode: filters.eco,
            maxBudget: filters.budget ? 100 : null
        };
        
        const res = await fetch(`${API_BASE}/optimize`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ source: pickup, destination: drop, constraints })
        });
        
        const data = await res.json();
        
        if (data.success && data.routes) {
            S.routes = data.routes;
            currentRoutes = data.routes;
            renderRoutes(data.routes);
            document.getElementById('routeSheet').classList.remove('collapsed');
        } else {
            showToast('No routes found', 'error');
        }
        
    } catch (err) {
        console.error(err);
        showToast('Failed to fetch routes', 'error');
    }
}

function showLoading() {
    document.getElementById('sheetBody').innerHTML = `
        <div class="loading-state">
            <div class="loader"></div>
            <h3 style="font-size:18px;font-weight:700;margin-bottom:8px">Finding best routes...</h3>
            <p style="color:var(--text2);font-size:14px">Analyzing traffic, prices & eco-options</p>
        </div>
    `;
    document.getElementById('routeSheet').classList.remove('collapsed');
}

function renderRoutes(routes) {
    if (!routes || routes.length === 0) {
        document.getElementById('sheetBody').innerHTML = `
            <div class="empty">
                <div class="empty-icon">üòû</div>
                <h3>No routes found</h3>
                <p>Try different locations or adjust your filters.</p>
            </div>
        `;
        return;
    }
    
    const html = `
        <h2 class="sheet-title">${routes.length} Routes Found</h2>
        ${routes.map((r, i) => {
            let badge = '';
            if (i === 0) badge = '<span class="route-badge">Best Value</span>';
            else if (r.carbon < 20) badge = '<span class="route-badge eco">Eco</span>';
            else if (r.duration < 30) badge = '<span class="route-badge fast">Fastest</span>';
            
            return `
                <div class="route-card" onclick="selectRoute(${i})">
                    <div class="route-top">
                        <div class="route-mode">
                            ${r.mode}
                            ${badge}
                        </div>
                        <div class="route-price">‚Çπ${r.cost}</div>
                    </div>
                    <div class="route-mid">
                        <div class="route-stat">
                            <div class="route-stat-label">Time</div>
                            <div class="route-stat-val">‚è±Ô∏è ${r.duration} min</div>
                        </div>
                        <div class="route-stat">
                            <div class="route-stat-label">Distance</div>
                            <div class="route-stat-val">üìç ${r.distance}</div>
                        </div>
                        <div class="route-stat">
                            <div class="route-stat-label">Carbon</div>
                            <div class="route-stat-val">üåø ${r.carbon}g</div>
                        </div>
                    </div>
                    <div class="route-bot">
                        <div class="route-score">
                            <div class="score-bar">
                                <div class="score-fill" style="width:${r.smartScore}%"></div>
                            </div>
                            <span class="score-num">${r.smartScore}/100</span>
                        </div>
                        <button class="route-btn" onclick="event.stopPropagation();bookRoute(${i})">Book Now</button>
                    </div>
                </div>
            `;
        }).join('')}
    `;
    
    document.getElementById('sheetBody').innerHTML = html;
}

function selectRoute(idx) {
    selectedRoute = currentRoutes[idx];
    showToast(`Selected: ${selectedRoute.mode}`, 'success');
}

function bookRoute(idx) {
    const route = currentRoutes[idx];
    
    showConfirm(
        'üöó',
        'Confirm Booking',
        `Book ${route.mode} for ‚Çπ${route.cost}?`,
        async () => {
            try {
                const res = await fetch(`${API_BASE}/wallet/use`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(route)
                });
                
                const data = await res.json();
                
                if (res.ok) {
                    S.wallet = data;
                    updateBalance();
                    
                    // Check for completed challenges
                    if (data.completedChallenges && data.completedChallenges.length > 0) {
                        data.completedChallenges.forEach(c => {
                            showToast(`üéâ Challenge Complete! ${c.title} - ${c.reward}`, 'success');
                        });
                    } else {
                        showToast(`Booked! Saved ‚Çπ${route.savings}`, 'success');
                    }
                    
                    loadHistory();
                    loadChallenges();
                } else {
                    showToast(data.error || 'Booking failed', 'error');
                }
            } catch (err) {
                showToast('Booking failed', 'error');
            }
        }
    );
}

function toggleSheet() {
    document.getElementById('routeSheet').classList.toggle('collapsed');
}

// =================== WALLET ===================
async function updateBalance() {
    try {
        const res = await fetch(`${API_BASE}/wallet`);
        const data = await res.json();
        S.wallet = data;
        
        document.getElementById('walletBal').textContent = `‚Çπ${data.balance.toLocaleString()}`;
        document.getElementById('walletBalance').textContent = `‚Çπ${data.balance.toLocaleString()}`;
        document.getElementById('walletSavings').textContent = `‚Çπ${data.totalSaved.toLocaleString()}`;
        
    } catch (err) {
        console.error('Failed to fetch wallet:', err);
    }
}

async function loadHistory() {
    try {
        const res = await fetch(`${API_BASE}/history`);
        const data = await res.json();
        
        if (data.trips && data.trips.length > 0) {
            const html = data.trips.map(t => `
                <div class="history-item">
                    <div class="hist-icon">üöó</div>
                    <div class="hist-info">
                        <div class="hist-mode">${t.mode}</div>
                        <div class="hist-details">${t.distance} ‚Ä¢ ${t.duration} min</div>
                        <div class="hist-date">${new Date(t.date).toLocaleDateString()}</div>
                    </div>
                    <div class="hist-right">
                        <div class="hist-cost">‚Çπ${t.cost}</div>
                        <div class="hist-savings">Saved ‚Çπ${t.savings}</div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('tripHistory').innerHTML = html;
        } else {
            document.getElementById('tripHistory').innerHTML = `
                <div class="empty" style="padding:20px">
                    <div class="empty-icon" style="font-size:40px">üìã</div>
                    <p style="color:var(--text2);font-size:14px">No trips yet</p>
                </div>
            `;
        }
    } catch (err) {
        console.error('Failed to load history:', err);
    }
}

async function loadChallenges() {
    try {
        const res = await fetch(`${API_BASE}/challenges`);
        const data = await res.json();
        
        if (data.success && data.challenges) {
            const challenges = data.challenges.targets;
            
            const html = challenges.map(c => {
                const progress = Math.round((c.current / c.target) * 100);
                const isCompleted = c.current >= c.target;
                
                return `
                    <div class="challenge-card ${isCompleted ? 'completed' : ''}">
                        ${isCompleted ? '<div class="challenge-completed-badge">‚úì DONE</div>' : ''}
                        <div class="challenge-top">
                            <div class="challenge-icon">${c.icon}</div>
                            <div class="challenge-reward">${c.reward}</div>
                        </div>
                        <div class="challenge-title">${c.title}</div>
                        <div class="challenge-desc">${c.description}</div>
                        <div class="challenge-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width:${progress}%"></div>
                            </div>
                            <div class="progress-text">${c.current}/${c.target}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('challengesContainer').innerHTML = html;
            
            // Show carbon stat if there's any carbon saved
            if (data.totalCarbonSaved > 0) {
                document.getElementById('carbonStat').style.display = 'block';
                document.getElementById('carbonVal').textContent = data.totalCarbonSaved + 'g';
            }
        }
    } catch (err) {
        console.error('Failed to load challenges:', err);
    }
}

let selectedTopupAmount = 0;

function selectAmount(amt) {
    selectedTopupAmount = amt;
    document.querySelectorAll('.amount-opt').forEach(el => el.classList.remove('selected'));
    event.target.closest('.amount-opt').classList.add('selected');
}

async function confirmTopup() {
    if (!selectedTopupAmount) {
        showToast('Please select an amount', 'error');
        return;
    }
    
    try {
        const res = await fetch(`${API_BASE}/wallet/topup`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ amount: selectedTopupAmount })
        });
        
        const data = await res.json();
        
        if (data.success) {
            S.wallet = data.wallet;
            updateBalance();
            closeModal('topupModal');
            showToast(`Added ‚Çπ${selectedTopupAmount}!`, 'success');
            selectedTopupAmount = 0;
        } else {
            showToast('Topup failed', 'error');
        }
    } catch (err) {
        showToast('Topup failed', 'error');
    }
}

// =================== AI ASSISTANT ===================
async function askAI() {
    const input = document.getElementById('aiInput');
    const message = input.value.trim();
    
    if (!message) return;
    
    // Add user message
    const messagesDiv = document.getElementById('aiMessages');
    messagesDiv.innerHTML += `<div class="ai-msg user">${message}</div>`;
    input.value = '';
    
    // Disable send button
    const sendBtn = document.getElementById('aiSendBtn');
    sendBtn.disabled = true;
    sendBtn.textContent = '...';
    
    try {
        const res = await fetch(`${API_BASE}/ai`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message })
        });
        
        const data = await res.json();
        
        if (data.success) {
            messagesDiv.innerHTML += `<div class="ai-msg bot">${data.reply}</div>`;
        } else {
            messagesDiv.innerHTML += `<div class="ai-msg bot">Sorry, I encountered an error.</div>`;
        }
        
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
        
    } catch (err) {
        console.error(err);
        messagesDiv.innerHTML += `<div class="ai-msg bot">Connection error. Please try again.</div>`;
    } finally {
        sendBtn.disabled = false;
        sendBtn.textContent = 'Send';
    }
}

// =================== TABS ===================
function openTab(tabId) {
    // Close all tabs
    document.querySelectorAll('.tab-view').forEach(t => t.classList.remove('active'));
    
    // Remove active from nav
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    
    if (tabId === 'mapView') {
        // Just return to map view
        event.target.closest('.nav-item').classList.add('active');
        return;
    }
    
    // Open selected tab
    document.getElementById(tabId).classList.add('active');
    
    // Highlight nav
    const navItems = document.querySelectorAll('.nav-item');
    if (tabId === 'walletView') {
        navItems[1].classList.add('active');
        loadHistory();
        loadChallenges();
    } else if (tabId === 'aiView') {
        navItems[2].classList.add('active');
    } else if (tabId === 'accountView') {
        navItems[3].classList.add('active');
        renderAccount();
    }
}

function closeTab(tabId) {
    document.getElementById(tabId).classList.remove('active');
    document.querySelectorAll('.nav-item')[0].classList.add('active');
}

function renderAccount() {
    document.getElementById('accountView').innerHTML = `
        <h2 class="sheet-title">üë§ Account</h2>
        <div style="text-align:center;padding:40px 20px">
            <div style="font-size:80px;margin-bottom:16px">üë§</div>
            <div style="font-size:20px;font-weight:700;margin-bottom:4px">User</div>
            <div style="font-size:14px;color:var(--text2)">user@onejourney.in</div>
        </div>
        <div style="background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px;margin-top:20px;cursor:pointer" onclick="showToast('Settings coming soon!','success')">
            <div style="font-size:14px;font-weight:600">‚öôÔ∏è Settings</div>
        </div>
        <div style="background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px;margin-top:10px;cursor:pointer" onclick="showToast('Help: support@onejourney.in','success')">
            <div style="font-size:14px;font-weight:600">üìû Help & Support</div>
        </div>
    `;
}

// =================== MODALS ===================
function openModal(modalId) {
    document.getElementById('overlay').classList.add('show');
    document.getElementById(modalId).classList.add('show');
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('show');
    if (!document.querySelector('.modal.show')) {
        document.getElementById('overlay').classList.remove('show');
    }
}

function closeAllModals() {
    document.querySelectorAll('.modal').forEach(m => m.classList.remove('show'));
    document.getElementById('overlay').classList.remove('show');
    hideConfirm();
}

// =================== TOAST ===================
function showToast(msg, type='success') {
    const toast = document.getElementById('toast');
    const icon = document.getElementById('toastIcon');
    document.getElementById('toastMsg').textContent = msg;
    toast.className = `toast show ${type}`;
    icon.textContent = type === 'success' ? '‚úì' : '‚ö†';
    clearTimeout(toast._t);
    toast._t = setTimeout(() => toast.classList.remove('show'), 3000);
}

// =================== CONFIRM ===================
function showConfirm(icon, title, text, onConfirm) {
    document.getElementById('cdIcon').textContent = icon;
    document.getElementById('cdTitle').textContent = title;
    document.getElementById('cdText').textContent = text;
    document.getElementById('overlay').classList.add('show');
    document.getElementById('confirmDialog').classList.add('show');
    document.getElementById('cdConfirm').onclick = () => { hideConfirm(); onConfirm(); };
}

function hideConfirm() {
    document.getElementById('confirmDialog').classList.remove('show');
    if (!document.querySelector('.modal.show')) {
        document.getElementById('overlay').classList.remove('show');
    }
}

// =================== UTILITIES ===================
function toggleTraffic() {
    document.getElementById('trafficToggle').classList.toggle('active');
    showToast('Traffic layer toggle coming soon', 'success');
}

function updateClock() {
    const now = new Date();
    document.getElementById('statusTime').textContent = now.toLocaleTimeString('en', { hour:'numeric', minute:'2-digit' });
}

function updateRiders() {
    const c = 5 + Math.floor(Math.random() * 15);
    document.getElementById('riderCount').textContent = c;
}

// =================== INIT ===================
document.addEventListener('DOMContentLoaded', () => {
    initMap();
    updateBalance();
    loadHistory();
    loadChallenges();
    updateClock();
    setInterval(updateClock, 30000);
    setInterval(updateRiders, 10000);
});
</script>
</body>
</html>